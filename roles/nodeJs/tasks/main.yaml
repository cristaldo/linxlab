---
  - name: Install NodeJS
    yum: name=nodejs state=present

  - name: Create directory for nodeJS Linx App
    file: path=/srv/www/nodejs state=directory

  - name: install NPM
    shell: npm i
    args:
      chdir: /srv/www/nodejs

  - name: Install Express
    npm:
      name: express
    args:
      path: /srv/www/nodejs
      global: no

  - name: Install PM2
    npm:
      name: pm2
      global: yes

#  - name: Copy TLS key
#    copy: src=files/nginx.key dest={{ key_file }} owner=root mode=0600

#  - name: Copy TLS certificate
#    copy: src=files/nginx.crt dest={{ cert_file }} owner=root mode=0600

#  - name: Copy Nginx config file
#    template: src=templates/nginx.conf.j2 dest={{ conf_file }}


  - name: Create app config file
    copy: src=app.js dest=/srv/www/nodejs/app.js

  - name: Start App Linx
    shell: pm2 -f start app.js
    args:
      chdir: /srv/www/nodejs

  - name: Systemd App Linx
    shell: pm2 startup 
    args:
      chdir: /srv/www/nodejs

  - name: Service PM2 Cluster
    service: name=pm2-root.service state=started enabled=yes

